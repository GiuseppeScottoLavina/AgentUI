import{i as Q}from"./chunk-5zmnagfw.js";import{o as W}from"./chunk-vdksh7v1.js";import{p as T,q as U}from"./chunk-4gkgmsys.js";class X extends T{static baseClass="au-dropdown";static cssFile="input";static observedAttributes=["placeholder","value","disabled"];#k=null;#z=null;#B=[];#C=!1;connectedCallback(){super.connectedCallback(),this.listen(window,"scroll",Q(()=>this.#F(),16),{capture:!0,passive:!0}),this.listen(window,"resize",Q(()=>this.#F(),100),{passive:!0})}disconnectedCallback(){super.disconnectedCallback(),this.#k?.remove()}attributeChangedCallback(k,B,G){if(!this.isConnected||B===G)return;if(k==="value"&&G!==null&&!this.#C){let C=this.#B.find((F)=>F.value===G);if(C){let F=this.querySelector(".au-dropdown__value");if(F)F.textContent=C.label;this.#k?.querySelectorAll(".au-dropdown__option").forEach((L)=>L.classList.toggle("is-active",L.getAttribute("data-value")===G))}}if(k==="disabled"){let C=this.querySelector(".au-dropdown__trigger");if(C)C.disabled=this.hasAttribute("disabled")}}render(){if(this.querySelector(".au-dropdown__trigger")&&this.#k)return;requestAnimationFrame(()=>this.#G())}#G(){if(this.querySelector(".au-dropdown__trigger")&&this.#k)return;let k=this.getAttribute("placeholder")||"Select",B=this.querySelectorAll("au-option"),G=this.querySelectorAll("option"),C=B.length>0?B:G;this.#B=Array.from(C).map((z)=>({value:z.getAttribute("value")||z.textContent.trim(),label:z.textContent.trim(),selected:z.hasAttribute("selected")})),this.#z=document.createElement("button"),this.#z.className="au-dropdown__trigger",this.#z.type="button";let F=`au-dropdown-menu-${Math.random().toString(36).slice(2,9)}`;this.#z.setAttribute("aria-haspopup","listbox"),this.#z.setAttribute("aria-expanded","false"),this.#z.setAttribute("aria-label",k),this.#z.setAttribute("popovertarget",F),this.#z.innerHTML=W`<span class="au-dropdown__value">${k}</span> <svg class="au-dropdown__arrow" width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"> <path d="M1 1l4 4 4-4"/> </svg>`,this.listen(this.#z,"keydown",(z)=>{if(!this.hasAttribute("disabled")){if(z.key==="ArrowDown"||z.key==="Enter"||z.key===" ")z.preventDefault(),this.open()}}),this.innerHTML="",this.appendChild(this.#z),this.#k=document.createElement("div"),this.#k.id=F,this.#k.className="au-dropdown__menu",this.#k.setAttribute("popover","auto"),this.#k.setAttribute("role","listbox"),this.#k.tabIndex=-1,this.listen(this.#k,"toggle",(z)=>{if(z.newState==="open")this.classList.add("is-open"),this.#z?.setAttribute("aria-expanded","true"),this.#F(),requestAnimationFrame(()=>{let J=this.getAttribute("value");(J?this.#k.querySelector(`[data-value="${J}"]`):this.#k.firstChild)?.focus()});else this.classList.remove("is-open"),this.#z?.setAttribute("aria-expanded","false")}),this.listen(this.#k,"keydown",(z)=>this.#J(z)),this.#B.forEach((z)=>{let J=document.createElement("div");J.className="au-dropdown__option",J.setAttribute("data-value",z.value),J.textContent=z.label,J.setAttribute("role","option"),J.tabIndex=-1,this.listen(J,"click",()=>this.select(z.value,z.label)),this.#k.appendChild(J)}),this.appendChild(this.#k);let L=this.#B.find((z)=>z.selected);if(L)this.select(L.value,L.label)}#J(k){let B=Array.from(this.#k.querySelectorAll(".au-dropdown__option")),G=document.activeElement,C=B.indexOf(G);if(k.key==="ArrowDown")k.preventDefault(),(B[C+1]||B[0])?.focus();else if(k.key==="ArrowUp")k.preventDefault(),(B[C-1]||B[B.length-1])?.focus();else if(k.key==="Enter"||k.key===" "){if(k.preventDefault(),C>=0){let F=this.#B[C];this.select(F.value,F.label)}}else if(k.key==="Escape")k.preventDefault(),this.close(),this.#z?.focus()}#F(){if(!this.#k||!this.#z)return;let k=this.#z.getBoundingClientRect(),B=this.#k.scrollHeight||200,F=window.innerHeight-k.bottom-8<B&&k.top>B?k.top-B-4:k.bottom+4;Object.assign(this.#k.style,{position:"fixed",margin:"0",top:`${F}px`,left:`${k.left}px`,width:`${k.width}px`,minWidth:"160px",maxHeight:"280px"})}toggle(){if(this.#k?.matches(":popover-open"))this.close();else this.open()}open(){if(this.hasAttribute("disabled")||!this.#k)return;this.#k.showPopover()}close(){if(this.#k?.matches(":popover-open"))this.#k.hidePopover()}select(k,B){this.#C=!0;let G=this.querySelector(".au-dropdown__value");if(G)G.textContent=B;this.setAttribute("value",k),this.#k?.querySelectorAll(".au-dropdown__option").forEach((C)=>C.classList.toggle("is-active",C.getAttribute("data-value")===k)),this.emit("au-select",{value:k,label:B}),this.close(),this.#C=!1}get value(){return this.getAttribute("value")||""}set value(k){this.setAttribute("value",k)}}class Y extends T{static baseClass="au-dropdown__option";connectedCallback(){super.connectedCallback(),this.setAttribute("role","option")}render(){}}U("au-dropdown",X);U("au-option",Y);export{Y as AuOption,X as AuDropdown};
