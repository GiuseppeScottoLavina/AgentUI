var X=typeof window<"u"?window:globalThis,U=["ui:toast","ui:modal","ui:theme","ui:tabs","ui:dropdown","ui:form","ui:grid","ui:stack","ui:virtual-list"],O={type:"ui-framework",version:"0.1.144",description:"AI-Optimized UI Framework - Web Components Edition"};class ${#j=new Map;#q=new Map;#z=new Map;#F=new Set;#J=new Set;#Q=100;#V=!1;#W=Date.now();peerId;capabilities;meta;constructor(j={}){this.peerId=j.peerId??"default",this.capabilities=j.capabilities??[],this.meta=j.meta??{},this.#V=j.debug??!1}on(j,q){if(j.endsWith("*")){let Q=j.slice(0,-1);if(!this.#q.has(Q))this.#q.set(Q,new Set);return this.#q.get(Q).add(q),{unsubscribe:()=>this.#q.get(Q)?.delete(q)}}if(!this.#j.has(j))this.#j.set(j,new Set);let z=q;this.#j.get(j).add(z);let J=this.#j.get(j).size;if(J>this.#Q)console.warn(`[AgentUI] Possible event leak: "${j}" has ${J} listeners (maxListeners: ${this.#Q}). Use setMaxListeners() to increase.`);return{unsubscribe:()=>this.#j.get(j)?.delete(z)}}off(j,q){if(j.endsWith("*")){let z=j.slice(0,-1);this.#q.get(z)?.delete(q);return}this.#j.get(j)?.delete(q)}emitSync(j,q){let z={event:j,data:q};for(let V of this.#J)z=V(z,{event:j})??z;let J=z;for(let V of this.#F)J=V(J,{event:j})??J;let Q=this.#j.get(j);if(Q)for(let V of Q)V(J);for(let[V,K]of this.#q)if(j.startsWith(V))for(let D of K)D(J)}async emit(j,q){return this.emitSync(j,q),{delivered:!0,event:j}}signal(j,q){this.emitSync(j,q)}hasListeners(j){return(this.#j.get(j)?.size??0)>0}handle(j,q){return this.#z.set(j,q),{unsubscribe:()=>this.#z.delete(j)}}unhandle(j){this.#z.delete(j)}async request(j,q,z){let J=this.#z.get(q);if(!J)throw Error(`No handler for '${q}'`);return J(z)}async broadcastRequest(j,q){return this.request(this.peerId,j,q)}addInboundHook(j){return this.#F.add(j),()=>this.#F.delete(j)}addOutboundHook(j){return this.#J.add(j),()=>this.#J.delete(j)}setMaxListeners(j){this.#Q=j}get debug(){return this.#V}get peers(){return[]}get peerCount(){return 0}healthCheck(){return{status:"healthy",peerId:this.peerId,uptime:Date.now()-this.#W,listeners:this.#j.size,handlers:this.#z.size}}destroy(){this.#j.clear(),this.#z.clear(),this.#F.clear(),this.#J.clear()}}if(!X.__AGENTUI_BUS__)X.__AGENTUI_BUS__=new $({peerId:"agentui",capabilities:U,meta:O});var F=X.__AGENTUI_BUS__,Z="__AGENTUI_COMPONENT_REGISTRY__";if(!X[Z])X[Z]=new Map;var Y=X[Z],W=new WeakMap,G={on(j,q){let z=(Q)=>{q(Q.data??Q)};if(!W.has(q))W.set(q,new Map);W.get(q).set(j,z);let J=F.on(j,z);return()=>{J.unsubscribe(),W.get(q)?.delete(j)}},once(j,q){let z=this.on(j,(J)=>{z(),q(J)})},off(j,q){let z=W.get(q)?.get(j);if(z)F.off(j,z),W.get(q)?.delete(j)},emit(j,q){return F.emitSync(j,q)},async emitAsync(j,q){return F.emit(j,q)},signal(j,q){F.signal(j,q)},async request(j,q,z){return F.request(j,q,z)},async broadcastRequest(j,q){return F.broadcastRequest(j,q)},handle(j,q){return F.handle(j,q)},unhandle(j){F.unhandle(j)},destroy(){F.destroy()},setMaxListeners(j){F.setMaxListeners(j)},get peerId(){return F.peerId},get peers(){return F.peers},get peerCount(){return F.peerCount},hasListeners(j){return F.hasListeners(j)},get raw(){return F}},L={TOAST_SHOW:"ui:toast:show",TOAST_DISMISS:"ui:toast:dismiss",MODAL_OPEN:"ui:modal:open",MODAL_CLOSE:"ui:modal:close",THEME_CHANGE:"ui:theme:change",TAB_CHANGE:"ui:tab:change",DROPDOWN_SELECT:"ui:dropdown:select",FORM_SUBMIT:"ui:form:submit",FORM_VALIDATE:"ui:form:validate"};var H=(j,q)=>{Y.set(j,{...q,registeredAt:Date.now()})};
export{G as j,L as k,H as l};
